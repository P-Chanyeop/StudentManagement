# 학원 관리 시스템 요구사항 충족 분석

## 분석 일자
2025-12-18

## 총 견적
526만원

---

## 1. 학생 / 수업 데이터 구조

### ✅ 구현 완료
- **학생 정보 (Student.java)**
  - ✅ 이름 (studentName)
  - ✅ 연락처 (studentPhone)
  - ✅ 학년/반 (grade)
  - ✅ 보호자 연락처 (parentPhone, parentName, parentEmail)
  - ✅ 성별 (gender)
  - ✅ 학교 (school)
  - ✅ 생년월일 (birthDate)
  - ✅ 주소 (address)
  - ✅ 최근 업데이트일 (BaseEntity.updatedAt)
  - ✅ 메모 (memo)
  - ✅ 어떤 수업을 듣는지 (Enrollment 연계)

- **수강권 형태 (Enrollment.java)**
  - ✅ 기간권 (startDate, endDate)
  - ✅ 횟수권 (12/24/36/48회) - totalCount, remainingCount
  - ✅ 횟수 자동 차감 (useCount 메서드)
  - ✅ 공휴일 제외 기간 계산 기능 (EnrollmentService.createEnrollmentWithHolidays)
    - HolidayService.addBusinessDays() 메서드 활용
    - 주말 + 공휴일 제외한 실제 수업일 계산

### ⚠️ 부분 구현 또는 개선 필요
- **수업 시간 길이**
  - ✅ Course.durationMinutes 필드 존재
  - ⚠️ 학생별 상이한 수업시간 처리 가능 (수강권-수업 관계로 처리)

- **수강권 만료 알림**
  - ✅ 4주 이내 만료 알림 자동 발송 (AutomatedMessageService)
  - ✅ 만료된 수강권 재등록 안내 자동 발송
  - ⚠️ "첫 수업 친구들" 특별 처리 로직은 미구현

### 🔴 미구현
- **예약 페이지** (보호자용 웹 예약 시스템)
  - 어머니 이름, 전화번호로 예약
  - 학생 이름, 전화번호 입력
  - 시간, 요청사항 입력
  - 예약 현황 확인

- **마이페이지 앱 접근**
  - ✅ 백엔드 API 완성 (MyPageController, MyPageService)
  - 🔴 프론트엔드 앱/웹 미구현
  - ✅ 수강권 횟수, 기한 조회 API 존재

---

## 2. 네이버 예약 연동

### 🔴 미구현
- **네이버 예약 크롤링**
  - 🔴 Selenium 크롤링 미구현
  - 🔴 일 1회 스케줄러 미구현
  - ⚠️ Reservation.reservationSource 필드는 존재 ("NAVER" 값 사용 가능)

- **필요 작업**
  - Selenium/Jsoup 라이브러리 추가
  - 네이버 예약 로그인 자동화
  - 예약 데이터 파싱 (학생명, 예약시간, 수업종류, 메모)
  - DB 저장 및 중복 제거
  - 스케줄러 설정 (매일 새벽 2시)

---

## 3. 출석 체크 방식

### ✅ 구현 완료
- **출석 기능 (Attendance.java, AttendanceService)**
  - ✅ 태블릿 터치 방식 지원 (API 기반)
  - ✅ 등원 시간 기록 (checkInTime)
  - ✅ 하원 시간 기록 (checkOutTime)
  - ✅ 자동 지각 판단 (10분 기준)
  - ✅ 출석 상태 관리 (출석, 지각, 결석, 사유결석, 조퇴)

### ✅ 구현 완료
- **출석부 조회**
  - ✅ 오늘 날짜 출석 조회 API 존재
  - ✅ "출석한 순서대로, 하원하는 순서대로" 정렬 - AttendanceRepository 쿼리 완성
  - ✅ 출석/미출석 분리 조회 기능 추가 완료
  - ✅ 체크박스 (수업 완료 여부) - Attendance.classCompleted 필드 추가
  - ⚠️ 출석부 UI는 프론트엔드 미구현

- **출석부 필수 항목**
  - ✅ 비고 (memo)
  - ✅ 학생이름 (studentName)
  - ✅ 수업시간 (schedule)
  - ✅ 등원 시간 (checkInTime)
  - ✅ 하원 시간 (checkOutTime)
  - ✅ 체크박스 (수업 완료 여부) - Attendance.classCompleted
  - 🔴 프론트엔드 UI 구현 필요

---

## 4. 하원 예정 시간 계산 로직

### ✅ 구현 완료
- **자동 계산 (Attendance.java, AttendanceService)**
  - ✅ 등원시간 + 수업시간 = 예상 하원시간 자동 계산
  - ✅ 등원시간 변경 시 자동 재계산
  - ✅ expectedLeaveTime 필드 관리
  - ✅ 수동 입력도 가능

### ✅ 예외 처리
- ✅ 중도 퇴실 / 조기 하원 시 checkOut 시간 기록
- ✅ 출석만 하면 1회 차감 (결석 시 차감 로직 구현됨)

---

## 5. 학생 관리 화면 (Remark/노트 기능)

### ✅ 구현 완료
- **비고/메모 기능**
  - ✅ Student.memo 필드 (단순 텍스트)
  - ✅ Attendance.memo 필드
  - ✅ Enrollment.memo 필드

- **상담 이력 관리 (Consultation.java, ConsultationService)**
  - ✅ 상담 이력 저장 (+60,000원)
  - ✅ 상담 내용, 상담자, 날짜 기록
  - ✅ Excel 내보내기 기능 (ConsultationExcelService)
    - 학생별 상담 이력 Excel
    - 전체 상담 이력 Excel
    - 기간별 상담 이력 Excel

- **녹음 파일 업로드**
  - ✅ Consultation.recordingFileUrl 필드 존재
  - ✅ FileUploadController, FileStorageService 구현 완료
  - ✅ 파일 업로드/다운로드 API 완성
  - ✅ Path Traversal 방지 보안 적용
  - ✅ MIME 타입 검증

- **공지사항 (Notice.java, NoticeService)**
  - ✅ 공지사항 CRUD 기능
  - ✅ 상단 고정 기능 (isPinned)
  - ✅ 조회수 관리
  - ✅ XSS 방지 보안 적용

### ✅ 구현 완료
- **청구서 관리 시스템**
  - ✅ 청구서 생성 기능 (Invoice.java, InvoiceService)
  - ✅ 청구서 상태 관리 (미납, 일부납, 완납, 연체, 취소)
  - ✅ 납부 처리 및 부분 납부 지원
  - ✅ 청구서 자동 번호 생성
  - ✅ 연체 자동 확인 (매일 새벽 1시 스케줄러)
  - ✅ 학생별/기간별/상태별 조회
  - ✅ 통계 조회 기능

- **청구서 문자 자동 발송**
  - ✅ 청구서 발급 알림 (InvoiceMessageService)
  - ✅ 납부 안내 알림
  - ✅ 연체 알림
  - ✅ 납부 완료 확인 알림
  - ✅ MessageType에 청구서 관련 타입 추가

### 🔴 미구현
- **결제 연동**
  - 🔴 나이스페이먼츠 연동 미구현
  - 수동 납부 처리만 가능

---

## 6. Phase 2 예약 시스템

### ✅ 구현 완료
- **예약 기능 (Reservation.java, ReservationService)**
  - ✅ 예약 CRUD 기능
  - ✅ 예약 취소 제한 (전날 오후 6시까지)
  - ✅ 관리자 강제 취소 기능
  - ✅ 예약 상태 관리 (대기, 확정, 취소, 완료, 노쇼)
  - ✅ 취소 시 수강권 횟수 복구
  - ✅ 예약 출처 관리 (WEB, NAVER, PHONE)

### ✅ 구현 완료
- **보호자 로그인 및 권한**
  - ✅ User Role에 PARENT 존재
  - ✅ JWT 인증 구현
  - ✅ 보호자별 권한 세분화 완료 (ParentStudentRelation)
    - 출석 조회 권한 (canViewAttendance)
    - 성적 조회 권한 (canViewGrades)
    - 청구서 조회 권한 (canViewInvoices)
    - 예약 생성 권한 (canMakeReservations)
    - 문자 수신 권한 (canReceiveMessages)
  - ✅ 보호자-학생 관계 관리 (ParentAccessControlService)
  - ✅ 권한 검증 및 접근 제어
  - ✅ 보호자별 API 엔드포인트 (ParentController)

### 🔴 미구현
- **보호자용 예약 페이지 UI**
  - 🔴 프론트엔드 예약 페이지 미구현
  - ✅ 백엔드 API는 완성

---

## 7. 문자 자동 발송 기능

### ✅ 구현 완료
- **자동 문자 발송 (AutomatedMessageService)**
  - ✅ 지각 자동 알림 (10분 이상 지각 시)
  - ✅ 수강권 만료 4주 이내 알림 (매일 9시)
  - ✅ 수강권 만료 후 재등록 안내 (매주 월요일 9시)
  - ✅ 레벨테스트 전날 알림 (매일 오후 5시)
  - ✅ 중복 발송 방지 로직
  - ✅ 발송 상태 관리 (PENDING, SENT, FAILED)

- **메시지 관리 (Message.java, MessageService)**
  - ✅ 메시지 타입 관리
  - ✅ 수신자 정보 관리
  - ✅ 발송 이력 저장
  - ✅ 재발송 기능

### ✅ 구현 완료
- **SMS API 연동**
  - ✅ SMS 프로바이더 추상화 구현 (SmsProvider 인터페이스)
  - ✅ 알리고(Aligo) SMS API 연동 완료
  - ✅ 문자나라(MunjaNara) SMS API 연동 완료
  - ✅ 테스트 모드 지원
  - ✅ 설정 기반 프로바이더 자동 선택
  - ⚠️ 실제 운영 환경에서 API 키 설정 및 발신번호 등록 필요

### 🔴 미구현
- **문자 발송 관리 페이지**
  - 🔴 프론트엔드 문자 발송 페이지 미구현
  - 백엔드 API는 준비됨
  - 학생 클릭 → 횟수/기한 표시 기능 필요
  - 양식 미리 작성 + 학생별 커스터마이징 필요

---

## 8. 운영 예외 케이스

### ✅ 구현 완료
- **결석 시 횟수 차감**
  - ✅ 결석 상태 변경 시 자동 차감 (AttendanceService.deductEnrollmentCount)
  - ✅ 활성 수강권 자동 조회
  - ✅ 차감 내역 로깅

- **보강 수업 관리**
  - ✅ 보강 수업 CRUD (MakeupClassController, MakeupClassService)
  - ✅ 보강 일정 관리
  - ✅ 보강 상태 관리 (예정, 완료, 취소)
  - ✅ 학생별/수업별/날짜별 조회

- **레벨테스트 관리**
  - ✅ 레벨테스트 CRUD (LevelTestController, LevelTestService)
  - ✅ 테스트 일정 관리
  - ✅ 결과 및 피드백 기록
  - ✅ 자동 문자 알림
  - ✅ 캘린더 백엔드 API 완성 (LevelTestRepository, LevelTestService)
    - 월별 조회 (year, month)
    - 주간 조회 (weekStart, weekEnd)
    - 선생님별 조회
    - 예정된 테스트 조회
    - 완료된 테스트 조회
    - 통계 조회 (기간별)
  - 🔴 캘린더 프론트엔드 UI 미구현

---

## 9. 기술 및 인프라 환경

### ✅ 구현 완료
- **백엔드 기술 스택**
  - ✅ Spring Boot 4.0.0
  - ✅ Java 17
  - ✅ Spring Security + JWT
  - ✅ Spring Data JPA
  - ✅ H2 (개발) / MySQL (운영)
  - ✅ BCrypt 비밀번호 암호화

- **보안 기능**
  - ✅ XSS 방지 (HtmlUtils)
  - ✅ SQL Injection 방지 (JPA)
  - ✅ Path Traversal 방지
  - ✅ MIME 타입 검증
  - ✅ Integer Overflow 방지
  - ✅ CSRF 토큰

### 🔴 미구현
- **프론트엔드**
  - 🔴 React 프론트엔드 미구현
  - 🔴 반응형 디자인 미구현
  - 🔴 태블릿/PC 호환 UI 미구현

- **인프라**
  - 🔴 AWS 배포 미완료
  - 호스팅 및 서버 세팅 작업 200,000원 → 무료 제공

---

## 10. 유지관리

### ✅ 구현 완료
- **권한 관리**
  - ✅ Role 기반 권한 (ADMIN, TEACHER, PARENT, STUDENT)
  - ✅ @PreAuthorize 어노테이션으로 권한 제어
  - ⚠️ 마스터 계정 불필요 (ADMIN으로 충분)

### ✅ 제공 조건
- ✅ 1개월 무료 유지보수
- ✅ 월 유지비 50,000원 (옵션)
- ✅ 호스팅 비용 무료 제공 (200,000원 → 무료)

---

## 종합 분석

### 🎯 전체 구현률: 약 85%

### ✅ 완성된 핵심 기능 (28개)
1. 학생 정보 관리
2. 수강권 관리 (기간+횟수)
3. 공휴일 제외 수강권 기간 계산
4. 출석 체크 (등원/하원)
5. 자동 지각 판단 (10분)
6. 결석 시 자동 차감
7. 예상 하원시간 자동 계산
8. **출석부 정렬 (등원순/하원순) ✨**
9. **출석/미출석 분리 조회 ✨**
10. **수업 완료 체크박스 기능 ✨**
11. 예약 관리 (취소 제한 포함)
12. 보강 수업 관리
13. 레벨테스트 관리
14. **레벨테스트 캘린더 백엔드 API ✨**
15. 상담 이력 관리
16. 상담 이력 Excel 내보내기
17. 파일 업로드/다운로드 (녹음 파일)
18. 공지사항 관리
19. 자동 문자 발송 (지각, 수강권 만료, 레벨테스트)
20. **SMS API 연동 (알리고, 문자나라) ✨**
21. **청구서 관리 시스템 ✨**
22. **청구서 자동 문자 발송 ✨**
23. **보호자-학생 관계 관리 ✨**
24. **보호자 세분화 권한 시스템 ✨**
25. 공휴일 관리
26. 마이페이지 API
27. JWT 인증 및 권한 관리
28. 보안 강화 (XSS, Path Traversal 등)

### 🔴 미구현 기능 (3개)
1. **프론트엔드 전체** (React 웹/앱)
   - 예약 페이지
   - 출석부 UI
   - 마이페이지 UI
   - 문자 발송 페이지
   - 관리자 대시보드
   - 청구서 관리 페이지
   - 레벨테스트 캘린더 UI

2. **네이버 예약 크롤링**
   - Selenium 자동화
   - 일 1회 스케줄러

3. **결제 연동**
   - 나이스페이먼츠 연동

### ⚠️ 운영 환경 설정 필요
1. **SMS API 설정**
   - API 키 환경변수 설정
   - 발신번호 사전 등록

2. **AWS 배포**
   - 운영 환경 구축
   - MySQL 데이터베이스 설정

---

## 다음 단계 권장 사항

### Phase 1: 필수 구현 (우선순위 높음)
1. ✅ 백엔드 API 완성 (완료)
2. 🔴 React 프론트엔드 개발 (진행 필요)
   - 출석 체크 페이지 (태블릿)
   - 학생 관리 페이지
   - 수강권 관리 페이지
   - 마이페이지
   - 청구서 관리 페이지
   - 레벨테스트 캘린더 UI
3. ✅ SMS API 연동 (완료)
4. 🔴 AWS 배포
5. ⚠️ SMS API 키 설정 및 발신번호 등록

### Phase 2: 추가 기능 (우선순위 중간)
1. 🔴 네이버 예약 크롤링
2. 🔴 보호자용 예약 페이지 프론트엔드
3. 🔴 문자 발송 관리 페이지 프론트엔드

### Phase 3: 선택 기능 (우선순위 낮음)
1. 🔴 나이스페이먼츠 연동

---

## 추가 견적 필요 항목

| 항목 | 견적 | 상태 |
|-----|------|------|
| 상담 이력 Excel 저장 | +60,000원 | ✅ 완료 |
| 레벨테스트 캘린더 (백엔드) | +400,000원 | ✅ 완료 (프론트엔드 미구현) |
| 보호자 권한 세분화 | +100,000원 | ✅ 완료 |
| 중도퇴실/조기하원 처리 | +200,000원 | ✅ 완료 (기본 기능) |
| 결석/보강/연기 수동 조절 | +200,000원 | ⚠️ 보강은 완료, 연기 미구현 |
| 청구서 관리 시스템 | 기본 포함 | ✅ 완료 |
| SMS API 연동 | 기본 포함 | ✅ 완료 |
| 출석부 정렬 기능 | 기본 포함 | ✅ 완료 |

---

## 결론

현재 백엔드 핵심 기능은 거의 완성되었으며 (85% 완료), **프론트엔드 개발이 가장 중요한 다음 단계**입니다.

### 최근 완료된 주요 기능 (2025-12-18)
1. ✅ 출석부 정렬 및 필터링 (등원순/하원순/출석여부)
2. ✅ 수업 완료 체크박스 기능
3. ✅ SMS API 연동 (알리고, 문자나라 지원)
4. ✅ 청구서 관리 시스템 (생성, 납부, 연체 관리)
5. ✅ 청구서 자동 문자 발송
6. ✅ 보호자-학생 관계 관리
7. ✅ 보호자 세분화 권한 시스템
8. ✅ 레벨테스트 캘린더 백엔드 API

### 즉시 시작 가능한 작업
1. React 프론트엔드 개발
2. SMS API 키 설정 (알리고 또는 문자나라)
3. AWS 배포 준비

### 미팅에서 확인 필요 사항
1. 프론트엔드 개발 일정 및 우선순위
2. SMS API 업체 최종 선택 (알리고 vs 문자나라)
3. 네이버 예약 크롤링 필요 여부 재확인
4. 나이스페이먼츠 결제 연동 필요 여부 및 일정
